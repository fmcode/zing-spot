<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Zing Relay</title>

	<link href="/bower/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="/bower/SpinKit/css/spinkit.css" rel="stylesheet">
	<link href="/bower/SpinKit/css/spinners/7-three-bounce.css" rel="stylesheet">
	<link href="/default.css" rel="stylesheet">
	<style>
		.jumbotron dt {
			text-align: right;
		}
		
		.jumbotron dd {
			text-align: left;
		}
		
		.right {
			text-align: right;
		}
		
		.addr {
			font-family: "Lucida Console", Monaco, monospace;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="header clearfix">
			<nav>
				<div class="pull-right" id="relay-info">
				</div>
			</nav>
			<h3><span class="text-muted">ZING</span> <strong>RELAY</strong></h3>
		</div>

		<div class="jumbotron">
			<h2>Server Disconnected</h1>
				<p class="lead">Cras justo odio, dapibus ac facilisis in, egestas eget quam. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum
					nibh, ut fermentum massa justo sit amet risus.</p>
		</div>

		<div class="row">
			<div class="sk-three-bounce" id="devicesLoading">
				<div class="sk-child sk-bounce1"></div>
				<div class="sk-child sk-bounce2"></div>
				<div class="sk-child sk-bounce3"></div>
			</div>
			<div class="col-md-12" id="devicesContainer" style="display: none">
				<h3 class="text-muted">NEARBY DEVICES</h3>
				<div class="table-responsive">
					<table class="table table-striped table-hover">
						<thead>
							<tr>
								<th></th>
								<th class="hidden-xs">Address</th>
								<th style="width: 100%">Name</th>
								<th class="right">RSSI</th>
								<th class="right">Count</th>
							</tr>
						</thead>
						<tbody id="discover">
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<footer class="footer">
			<p>&copy; 2017 ZING</p>
		</footer>
	</div>
	<!-- /container -->

	<script src="/bower/jquery/dist/jquery.min.js"></script>
	<script src="/bower/numeral/min/numeral.min.js"></script>
	<script src="/bower/moment/min/moment.min.js"></script>
	<script src="/bower/lodash/dist/lodash.core.min.js"></script>
	<script>
		function makeDiscoverTableRow(val) {
			var TR = $('<tr/>');
			TR.append($('<td/>', {
				html: '<input type="checkbox">'
			}));
			TR.append($('<td/>', {
				class: 'addr hidden-xs',
				text: val.addr
			}));

			var nameTD = $('<td/>');
			TR.append(nameTD);
			nameTD.append($('<strong/>', {
				text: val.name
			}));
			nameTD.append($('<div/>', {
				class: 'addr visible-xs',
				text: val.addr
			}));

			TR.append($('<td/>', {
				class: 'right',
				text: numeral(val.rssi_total / val.rssi_count).format('0.0')
			}));
			TR.append($('<td/>', {
				class: 'right',
				text: val.rssi_count
			}));
			return TR;
		}

		$(function () {
			$.getJSON('/api/info', function (data) {
				var items = [];
				items.push($('<div/>', {
					class: 'addr right',
					text: data.mac
				}));
				items.push($('<div/>', {
					class: 'right',
					text: 'v' + data.version
				}));
				$('#relay-info').empty().append(items);
			});

			setInterval(
				function () {
					$.getJSON('/api/discover', function (data) {
						$('#devicesLoading').remove();
						$('#devicesContainer').show();

						var items = [];
						_.each(
							_.sortBy(data, function (v) {
								return (v.rssi_total / v.rssi_count);
							}).reverse(),
							function (v) {
								items.push(makeDiscoverTableRow(v));
							});

						$('#discover').empty().append(items);
					});
				}, 2000
			)
		});
	</script>
</body>

</html>